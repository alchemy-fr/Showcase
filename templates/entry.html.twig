{% extends "base.html.twig" %}
{% import "macros.html.twig" as macros %}

{% block head %}
    {{ parent() }}
    <link href="http://vjs.zencdn.net/c/video-js.css" rel="stylesheet">
    <script src="http://vjs.zencdn.net/c/video.js"></script>
    <script>
        $(document).ready(function(){
            $('.carousel').carousel('pause');
            $('.carousel').bind('slid mouseleave', function() {
                $('.carousel').carousel('pause');
            });
        });
    </script>
{% endblock %}

{% block title %}- {{ entry.getTitle() }}{% endblock %}

{% block headerTitle %}
    {{ macros.navFeedList(feeds, feed) }}
{% endblock %}

{% block content %}
    <div class="contentArticle span10 offset1">
        <div id="textArticle">
            <h1>{{ entry.getTitle() }}</h1>
            <p>
                <span class="infosArticle">Date de publication : </span>{{ entry.getCreatedOn() | date('d/m/Y') }}.<br />
                <span class="infosArticle">Derni&egrave;re &eacute;dition : </span>{{ entry.getUpdatedOn() | date('d/m/Y') }}.<br />
                <span class="infosArticle">Auteur : </span>{{ entry.getAuthorName() }}<br />
            </p>
            <p>
                <span class="infosArticle">Description : </span>{{ entry.getSubtitle() }}<br />
                <span class="infosArticle">M&eacute;dias : </span>                
                {% set items = entry.getItems() %}
                {% if items | length > 1 %}
                    {{ items | length }} m&eacute;dias pr&eacute;sents dans cette publication.
                {% elseif items | length == '1' %}
                    1 m&eacute;dia pr&eacute;sent dans cette publication.
                {% else %}
                    Aucun m&eacute;dia pr&eacute;sent dans cette publication.
                {% endif %}
            </p>
            <a class="logoMinus" href="/feed/{{ feed.getId() }}/0/5"></a>
        </div><!-- /textArticle -->
    </div><!-- /contentArticle -->
    
    <div class="imgArticle span8 offset2">
        <div id="carouselArticle" class="carousel">
            <div class="carousel-inner">
                {# if there is at least one item in the entry #}
                {% if items | length > 0 %}
                    {% for item in items %}
                        {% set record = item.getRecord() %}
                        {% if loop.first %}
                            <div class="item active">
                        {% else %}
                            <div class="item">     
                        {% endif %}
                            <table border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td valign="center" align="center">
                                        {# if item is an image #}
                                        {% if record.getPhraseaType() == 'image' %}
                                            {% for subdef in record.getSubdefs() %}
                                                {% set subName = subdef.getName() %}
                                                {% if subName == 'preview' %}
                                                    {% set previewUrl = subdef.getPermalink().getUrl() %}
                                                    <img src="{{ previewUrl }}" />
                                                {% endif %}
                                            {% endfor %}
                                        {# if item is a video #}
                                        {% else %}
                                            <video id="my_video_1" class="video-js vjs-default-skin" controls
                                                preload="auto" width="640" height="264" poster="http://video-js.zencoder.com/oceans-clip.jpg"
                                                data-setup="{}">
                                                <source src="http://video-js.zencoder.com/oceans-clip.mp4" type='video/mp4'>
                                            </video>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                            <div class="carousel-caption">
                                <h4>{{ record.getTitle() }}</h4>
                                <p>MimeType : {{ record.getMimeType() }}</p>
                            </div>
                        </div>
                    {% endfor %}
                    {# test for video
                    <div class="item">
                        <table border="0" cellpadding="0" cellspacing="0">
                            <tr>
                                <td valign="center" align="center">
                                    <video id="my_video_1" class="video-js vjs-default-skin" controls
                                        preload="auto" width="640" height="264" poster="http://video-js.zencoder.com/oceans-clip.jpg"
                                        data-setup="{}">
                                        <source src="http://video-js.zencoder.com/oceans-clip.mp4" type='video/mp4'>
                                    </video>
                                </td>
                            </tr>
                        </table>
                        <div class="carousel-caption">
                            <h4>test video</h4>
                            <p>MimeType : video/mp4</p>
                        </div>
                    </div> #}
                    
                {# if there is no media in the entry #}
                {% else %}
                    <div class="item active">
                        <table border="0" cellpadding="0" cellspacing="0">
                            <tr>
                                <td id="noItem" valign="center" align="center">Aucun m&eacute;dia disponible</td>
                            </tr>
                        </table>
                    </div>
                {% endif %}
            </div><!-- /carousel-inner -->
            <a id="ccLeft" class="carousel-control left" href="#carouselArticle" data-slide="prev">&lsaquo;</a>
            <a id="ccRight" class="carousel-control right" href="#carouselArticle" data-slide="next">&rsaquo;</a>
        </div><!-- /carouselArticle -->
    </div><!-- /imgArticle -->
{% endblock %}

{% block footer %}
    {{ macros.navFeedList(feeds, feed) }}
{% endblock %}
